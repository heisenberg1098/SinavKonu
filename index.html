<!DOCTYPE html>
<html lang="tr">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sınav Konu Takip Sistemi</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=Dancing+Script:wght@600&display=swap"
        rel="stylesheet">

    <style>
        :root {
            --primary-color: #060031;
            --secondary-color: #00C9E2;
            --bg-light: #D6FFFF;
            --text-dark: #060031;
            --text-muted: #6c757d;
            --white: #ffffff;
            --danger: #ff4d4d;
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--bg-light);
            color: var(--text-dark);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        .navbar {
            background-color: var(--primary-color) !important;
            padding: 10px 0;
        }

        .navbar-brand {
            display: flex;
            align-items: center;
            font-weight: 700;
        }

        .navbar-brand img {
            height: 40px;
            margin-right: 12px;
        }

        /* Dönem Göstergesi Stili */
        .period-banner {
            background: var(--white);
            border-bottom: 3px solid var(--secondary-color);
            padding: 15px 0;
            text-align: center;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.05);
        }

        .course-card {
            background: var(--white);
            border-radius: 12px;
            margin-bottom: 12px;
            border: none;
            box-shadow: 0 4px 15px rgba(6, 0, 49, 0.05);
        }

        .course-header {
            padding: 18px;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .course-title {
            font-weight: 700;
            color: var(--primary-color);
            margin: 0;
        }

        .teacher-name {
            color: var(--text-muted);
            font-size: 0.85rem;
        }

        .topics-list {
            padding: 15px 20px;
            border-top: 1px solid #f1f1f1;
        }

        .topic-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 0;
            border-bottom: 1px solid #f8f9fa;
        }

        .period-badge {
            font-size: 0.7rem;
            padding: 3px 8px;
            border-radius: 20px;
            background: var(--bg-light);
            color: var(--primary-color);
            border: 1px solid var(--secondary-color);
            margin-left: 10px;
        }

        .btn-add {
            background-color: var(--secondary-color);
            color: var(--primary-color);
            font-weight: 600;
            border: none;
        }

        .btn-delete {
            color: var(--danger);
            cursor: pointer;
            font-size: 0.8rem;
            border: 1px solid var(--danger);
            padding: 2px 8px;
            border-radius: 4px;
        }

        footer {
            margin-top: auto;
            padding: 20px 0;
            text-align: center;
            background: var(--primary-color);
            color: white;
        }

        .signature {
            font-family: 'Dancing Script', cursive;
            font-size: 1.5rem;
            color: var(--secondary-color);
            margin-left: 5px;
        }

        .modal-content {
            border-radius: 15px;
            border: none;
        }

        .modal-header {
            background: var(--primary-color);
            color: white;
            border-radius: 15px 15px 0 0;
        }
    </style>
</head>

<body>

    <nav class="navbar navbar-dark shadow-sm">
        <div class="container">
            <a class="navbar-brand" href="#">
                <img src="ME.png" alt="Logo">
                <span>Sınav Takvimi</span>
            </a>
            <div>
                <span id="adminBadge" class="badge bg-success d-none me-2">Yönetici Modu</span>
                <button class="btn btn-outline-light btn-sm" id="loginBtn" data-bs-toggle="modal"
                    data-bs-target="#adminModal">Giriş</button>
            </div>
        </div>
    </nav>

    <div class="period-banner mb-4">
        <div class="container">
            <h6 class="text-muted mb-2 small fw-bold text-uppercase">Aktif Sınav Dönemi</h6>
            <h4 id="currentPeriodDisplay" class="fw-bold text-dark">Yükleniyor...</h4>

            <div id="adminPeriodControls" class="mt-3 d-none">
                <div class="btn-group btn-group-sm">
                    <button class="btn btn-outline-primary" onclick="updatePeriod('1. Dönem 1. Yazılı')">1.D
                        1.Y</button>
                    <button class="btn btn-outline-primary" onclick="updatePeriod('1. Dönem 2. Yazılı')">1.D
                        2.Y</button>
                    <button class="btn btn-outline-primary" onclick="updatePeriod('2. Dönem 1. Yazılı')">2.D
                        1.Y</button>
                    <button class="btn btn-outline-primary" onclick="updatePeriod('2. Dönem 2. Yazılı')">2.D
                        2.Y</button>
                </div>
            </div>
        </div>
    </div>

    <div class="container py-2">
        <div class="card p-4 mb-5 border-0 shadow-sm">
            <h5 class="fw-bold mb-3 text-center">Yeni Konu Ekle</h5>
            <div class="row g-2">
                <div class="col-md-4">
                    <select id="courseSelect" class="form-select"></select>
                </div>
                <div class="col-md-6">
                    <input type="text" id="topicInput" class="form-control" placeholder="Konu başlığı...">
                </div>
                <div class="col-md-2">
                    <button class="btn btn-add w-100" onclick="addTopic()">Ekle</button>
                </div>
            </div>
            <p class="text-center mt-2 mb-0 small text-muted">Konular o an seçili olan sınav dönemine eklenecektir.</p>
        </div>

        <div id="courseContainer"></div>
    </div>

    <footer>
        <div class="container">
            © 2026 Tüm Hakları Saklıdır<p class="mb-0 text-white"> <span class="signature">M.Enes Yalçın</span> Tarafından Yapılmıştır</p>
        </div>
    </footer>

    <div class="modal fade" id="adminModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content text-center">
                <div class="modal-header border-0">
                    <h5 class="modal-title w-100">Yönetici Doğrulaması</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body p-4">
                    <img src="ME.png" alt="Logo"
                        style="height: 60px; margin-bottom: 15px;background-color: #060031; border-radius: 15px;">
                    <input type="password" id="adminPasswordInput" class="form-control form-control-lg text-center"
                        placeholder="Şifre">
                    <button class="btn  w-100 mt-3 py-2" style="background-color: #00C9E2;color:#D6FFFF ;"
                        onclick="checkAdminPassword()">Giriş Yap</button>
                </div>
            </div>
        </div>
    </div>

    <script type="module">
        // Gerekli tüm fonksiyonları buradan içeri aktarıyoruz
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import {
            getFirestore,
            collection,
            addDoc,
            onSnapshot,
            doc,
            getDoc,
            deleteDoc,
            updateDoc,
            setDoc
        } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyBj5-YThuISyG9SbBFwKGqqrcluP-p3y4Y",
            authDomain: "sinavkonu-a7f93.firebaseapp.com",
            projectId: "sinavkonu-a7f93",
            storageBucket: "sinavkonu-a7f93.firebasestorage.app",
            messagingSenderId: "32060905024",
            appId: "1:32060905024:web:2d1f16c0ba38df5994f1a5"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        let isAdmin = false;
        let currentPeriod = "1. Dönem 1. Yazılı";

        // --- BAŞLANGIÇ AYARLARI (Şifre ve Dönem Yoksa Oluşturur) ---
        async function setupInitialSettings() {
            try {
                const adminRef = doc(db, "settings", "admin");
                const adminSnap = await getDoc(adminRef);
                if (!adminSnap.exists()) {
                    await setDoc(adminRef, { password: "123" });
                }

                const periodRef = doc(db, "settings", "period");
                const periodSnap = await getDoc(periodRef);
                if (!periodSnap.exists()) {
                    await setDoc(periodRef, { active: "1. Dönem 1. Yazılı" });
                }
            } catch (e) { console.error("Başlangıç hatası:", e); }
        }
        setupInitialSettings();

        // Admin Şifre Kontrolü
        window.checkAdminPassword = async () => {
            const inputPass = document.getElementById('adminPasswordInput').value;
            const docSnap = await getDoc(doc(db, "settings", "admin"));
            if (docSnap.exists() && docSnap.data().password === inputPass) {
                isAdmin = true;
                document.getElementById('adminBadge').classList.remove('d-none');
                document.getElementById('adminPeriodControls').classList.remove('d-none');
                document.getElementById('loginBtn').classList.add('d-none');
                bootstrap.Modal.getInstance(document.getElementById('adminModal')).hide();
            } else { alert("Hatalı şifre!"); }
        };

        // Dönemi Güncelle (Admin)
        window.updatePeriod = async (newPeriod) => {
            if (!isAdmin) return;
            await setDoc(doc(db, "settings", "period"), { active: newPeriod }, { merge: true });
        };

        // Konu Ekleme
        window.addTopic = async () => {
            const course = document.getElementById('courseSelect').value;
            const topic = document.getElementById('topicInput').value;
            if (!topic) return;
            await addDoc(collection(db, "topics"), {
                courseName: course,
                topicName: topic,
                period: currentPeriod,
                createdAt: new Date()
            });
            document.getElementById('topicInput').value = "";
        };

        // Konu Silme
        window.deleteTopic = async (id) => {
            if (!isAdmin) {
                new bootstrap.Modal(document.getElementById('adminModal')).show();
                return;
            }
            if (confirm("Bu konuyu silmek istiyor musunuz?")) await deleteDoc(doc(db, "topics", id));
        };

        const courses = [
            { name: "Din Kültürü ve Ahlak Bilgisi", teacher: "Esra Çalışkan" },
            { name: "Seçmeli Biyoloji", teacher: "Atilla Yıldız" },
            { name: "Seçmeli Coğrafya", teacher: "Muhammet Enes Durgun" },
            { name: "Seçmeli Felsefe", teacher: "Müşerref Çetinkaya" },
            { name: "Seçmeli Fizik", teacher: "Vasif Atiç" },
            { name: "Seçmeli Kimya", teacher: "Serap Ünlükara" },
            { name: "Seçmeli Matematik", teacher: "Mustafa Özışık" },
            { name: "Seçmeli Türk Dili ve Edebiyatı", teacher: "Hayri Uysal" },
            { name: "Tarih", teacher: "Mehmet Büyükbozkoyun" },
            { name: "T.C. İnkılâp Tarihi ve Atatürkçülük", teacher: "Büşra Koç" },
            { name: "Türk Dili ve Edebiyatı", teacher: "Demet Özel" },
            { name: "Yabancı Dil", teacher: "Burak Bekret" }
        ];

        window.onload = () => {
            const container = document.getElementById('courseContainer');
            const select = document.getElementById('courseSelect');
            select.innerHTML = courses.map(c => `<option>${c.name}</option>`).join('');

            container.innerHTML = courses.map((c, i) => `
            <div class="course-card">
                <div class="course-header" data-bs-toggle="collapse" data-bs-target="#c${i}">
                    <div><div class="course-title">${c.name}</div><div class="teacher-name">${c.teacher}</div></div>
                    <span>▼</span>
                </div>
                <div id="c${i}" class="collapse"><div class="topics-list" id="list-${c.name.replace(/\s+/g, '')}"></div></div>
            </div>
        `).join('');

            // Aktif Dönemi İzle
            onSnapshot(doc(db, "settings", "period"), (doc) => {
                if (doc.exists()) {
                    currentPeriod = doc.data().active;
                    document.getElementById('currentPeriodDisplay').innerText = currentPeriod;
                }
            });

            // Konuları İzle
            onSnapshot(collection(db, "topics"), (snap) => {
                courses.forEach(c => {
                    const listEl = document.getElementById(`list-${c.name.replace(/\s+/g, '')}`);
                    if (listEl) listEl.innerHTML = "";
                });
                snap.forEach(doc => {
                    const data = doc.data();
                    const list = document.getElementById(`list-${data.courseName.replace(/\s+/g, '')}`);
                    if (list) {
                        list.innerHTML += `
                        <div class="topic-item">
                            <div>
                                <span>${data.topicName}</span>
                                <span class="period-badge">${data.period || "Genel"}</span>
                            </div>
                            <span class="btn-delete" onclick="deleteTopic('${doc.id}')">Sil</span>
                        </div>`;
                    }
                });
            });
        };
    </script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>

</html>